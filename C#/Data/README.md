# Этап 2. Разработка слоя доступа к данным

## Описание
На этом этапе реализован слой доступа к данным с использованием паттерна Repository. Это обеспечивает абстракцию над базой данных и позволяет легко менять реализацию хранения данных.

## Компоненты

### 1. Базовый интерфейс IRepository<T>
```csharp
public interface IRepository<T> where T : class
{
    IEnumerable<T> GetAll();
    T? GetById(int id);
    void Add(T entity);
    void Update(T entity);
    void Delete(int id);
}
```

### 2. Базовый класс BaseRepository
- Содержит общую функциональность для работы с БД
- Управляет подключением к базе данных
- Обрабатывает SQL-команды
- Реализует обработку ошибок

### 3. Специализированные репозитории
- **MemberRepository**: работа с членами клуба
- **MembershipRepository**: управление абонементами
- **MemberMembershipRepository**: управление привязками абонементов

## Особенности реализации

1. **Работа с подключением**
   - Использование using для автоматического освобождения ресурсов
   - Централизованное создание подключений
   - Обработка ошибок подключения

2. **SQL-запросы**
   - Параметризованные запросы для безопасности
   - Защита от SQL-инъекций
   - Эффективное использование подготовленных команд

3. **Обработка ошибок**
   - Собственный класс DatabaseException
   - Информативные сообщения об ошибках
   - Сохранение исходного исключения

4. **Маппинг данных**
   - Преобразование результатов запросов в объекты
   - Обработка NULL-значений
   - Корректная работа с типами данных

## Примеры использования

```csharp
// Создание репозитория
var memberRepo = new MemberRepository(connectionString);

// Получение всех членов клуба
var members = memberRepo.GetAll();

// Добавление нового члена
memberRepo.Add(new Member { 
    FirstName = "Иван", 
    LastName = "Петров" 
});

// Обновление данных
memberRepo.Update(member);

// Удаление
memberRepo.Delete(id);
```

## Преимущества подхода

1. **Разделение ответственности**
   - Отделение логики доступа к данным
   - Упрощение тестирования
   - Улучшение поддерживаемости

2. **Переиспользование кода**
   - Общая функциональность в базовом классе
   - Единый подход к обработке ошибок
   - Стандартизация работы с БД

3. **Гибкость**
   - Возможность замены СУБД
   - Легкое добавление новых репозиториев
   - Простота модификации 